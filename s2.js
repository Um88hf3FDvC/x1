"use strict";const NO={n:"n"},OE=Object.entries,OK=Object.keys,RE=RegExp,RQ=require,CL=console.log,JS=JSON.stringify,JP=JSON.parse,DN=Date.now,ZL=RQ("zlib"),CD=ZL.createDeflate,ID=ZL.createInflate,CZ=ZL.createGzip,IZ=ZL.createGunzip,CB=ZL.createBrotliCompres,IB=ZL.createBrotliDecompress,FS=RQ("fs"),CR=RQ("crypto"),SW=RQ("stream").Writable,SR=RQ("stream").Readable,PT=RQ("stream").PassThrough,MX=Math.max,MN=Math.min,NX=Number.MAX_VALUE,NN=Number.MIN_VALUE,X={PQ:(e,t)=>(OE(t).map(t=>{e[t[0]]=e[t[0]]||[],e[t[0]].push(t[1])}),e),J2P:e=>e.reduce(X.PQ,{}),P2J:e=>e[OK(e)[0]].map((t,r)=>OK(e).reduce((t,a,c)=>(t[a]=e[OK(e)[c]][r],t),{})),C2J:e=>e.split("\n").map((e,t,r)=>e.split(",").reduce((e,t,a)=>(e[r[0].split(",")[a]]=t,e),{})).slice(1),LOP:(e,t,r)=>(e[t]=r,e),LLP:e=>[...new Set(e)].reduce(X.LOP,{}),DOP:(e,t)=>(e[t]=(e[t]||0)+1,e)},http=RQ("http"),cfg=RQ("./package.json").config,rw={wbF:async(e,t,r,a=e,c=CD())=>{const s=FS.createWriteStream(t.data+a+"."+t.zip),i=new SR;i.push(JS(r[e].filter(e=>e._utime>stime))),i.push(null),i.pipe(c).pipe(s),t.is_debug&&CL(`BKwbF${e}/${a} RECS ${r[e].length}`)},rbf:async(e,t,r,a=!1,c=ID(),s="deflate",i=e)=>{const u=FS.createReadStream(t.data+e+"."+s),l=new SW;let n=[],d=0;l.on("error",r=>t.is_debug&&CL("ERR WSTRM",e,r)),l.on("finish",()=>{let e=Buffer.alloc(d);for(let t=0,r=n.length,a=0;t<r;t++)n[t].copy(e,a),a+=n[t].length;r[i]=[].concat(a&&r[i]||[],JP(e.toString())),r._all[i]=r[i].length,"lookup"===s&&(r[i]=r[i][0]),t.is_debug&&CL(`WS4 ${i} LN ${d} RCS ${r[i].length}`)}),l.write=(e=>{n.push(e),d+=e.length}),u.pipe(c).pipe(l)},rbfa:async(e,t)=>{await Promise.all(e.tabs.map(async r=>rw.rbf(r,e,t)))},rdf:async(e,t)=>FS.readdir(e.app,(r,a)=>a.forEach(r=>FS.readFile(e.app+r,(a,c)=>{if(a)throw a;let s=e.is_fcrypt?CR.createHmac("sha256",e.cert+DN()).update(r).digest("hex"):r;t._file[r]=s,t[s]=c,e.is_debug&&CL(`fcrypt ${e.is_fcrypt} FILE ${r} loaded ${c.length} ${s}`)})))},FX={eF:e=>t=>r=>r[e].toString()===t.toString(),rF:e=>t=>r=>new RE(t,"i").test(r[e]),NrF:e=>t=>r=>!new RE(t,"i").test(r[e]),tF:e=>()=>t=>t[e],NtF:e=>()=>t=>!t[e],gF:e=>t=>r=>r[e]>=t,lF:e=>t=>r=>r[e]<=t,bF:e=>t=>r=>r[e]>=t.k&&r[e]<=t.g,NbF:e=>t=>r=>r[e]<=t.k&&r[e]>=t.g,iF:e=>t=>r=>new RE(t.join("|")).test(r[e]),mfs:e=>t=>r=>e.reduce((e,a)=>e||new RE(t.replace(/([*()\]])/g,"$1"),"i").test(r[a].replace(/[()<>;]/g,"").replace(/([.\/-])/g,"$1")),!1)},mfms=e=>(t,r)=>t.filter(FX.mfs(e)(r)),eof=e=>(t,r)=>(-1===t.indexOf(r[e])&&t.push(r[e]),t),fc=(e,t)=>e.filter(FX[t.f](t.k)(t.v)),fo=(e,t)=>(r,a)=>r.concat(e.filter(e=>e[t]===a)),as=e=>t=>e.reduce((e,r)=>(e[r]=t[r],e),{}),KV=e=>({k:e[0],v:e[1]}),DG=e=>e.reduce((e,t)=>(OE(t).reduce((e,t)=>(e[t[0]]=(e[t[0]]||0)+t[1],e),e),e),{}),MO=e=>e.reduce((e,t)=>(e[t]={},e),{}),aly=(e,t=1,r=1)=>(a,c)=>(OK(e).forEach(e=>{a[e][c[e]]=(a[e][c[e]]||0)+(c[t]||1)*(c[r]||1)}),a),U=(e,t)=>e.reduce((e,r)=>e+"_"+t[r],""),alx=(e,t,r=1,a=1)=>(t,c)=>(t[U(e,c)]=(t[U(e,c)]||0)+(c[r]||1)*(c[a]||1),t),ald=(e,t,r=1,a=1)=>(t,c)=>(t[U(e,c)]=(t[U(e,c)]||0)+(c[r]||0)-(c[a]||0),t),valm=(e,t,r=1,a=1)=>(t,a)=>(t[U(e,a)]=Math.max(t[U(e,a)]||Number.MIN_VALUE,a[r]||Number.MIN_VALUE),t),alm=(e,t,r=1,a=1)=>(t,a)=>(t[U(e,a)]=MX(t[U(e,a)]||NN,a[r]||NN),t),aln=(e,t,r=1,a=1)=>(t,a)=>(t[U(e,a)]=MN(t[U(e,a)]||NX,a[r]||NX),t),j2c=(e,t)=>e+OE(t).reduce((e,t)=>e+";"+t[1],"\n"),icuv=(e,t)=>(e._id=e._id||"VSWA"+DN().toString(35)+t,e._ctime=e._ctime||DN(),e._utime=DN(),e._version=(e._version||0)+1,e),bxpl=e=>{const t=e.map(e=>e||0).sort((e,t)=>e-t);return{min:t[0],q1:t[parseInt(.25*t.length)],q5:t[parseInt(.5*t.length)],mean:t.reduce((e,t,r,a)=>e+(t||0)/a.length,0),q7:t[parseInt(.75*t.length)],max:t[t.length-1],l:t.length}},buzz=(e,t)=>OE(e.reduce((e,r)=>(r[t].split(/\W/).filter(e=>e.length>7).map(e=>e.toLowerCase()).reduce((e,t)=>(e[t]=(e[t]||0)+1,e),e),e),{})).map(KV).sort((e,t)=>t.v-e.v).slice(0,50),FC=(e,t="")=>new Promise((r,a)=>{"https"===e.prot&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED="0");const c=require(e.prot).request({host:e.host,port:e.port,method:e.method,path:e.path,headers:{"Proxy-Authorization":e.pauth||"",Accept:"application/json",Authorization:"Basic "+e.auth,"x-encoding":e.senc?"deflate":"","accept-encoding":e.renc?"deflate":""}},t=>{let a=new SW,c=[],s=0;a.write=(e=>{c.push(e),s+=e.length}),a.on("error",e=>{CL("XRES-ErRor: "+e.message)}),a.on("finish",()=>{let e=Buffer.alloc(s);for(let t=0,r=c.length,a=0;t<r;t++)c[t].copy(e,a),a+=c[t].length;r(e.toString())}),e.renc?t.pipe(ZL.createInflate()).pipe(a):t.pipe(a)});c.on("error",e=>{CL("XREQ-ERror: "+e.message)});let s=new SR;s.push(t),s.push(null),e.senc?s.pipe(ZL.createDeflate()).pipe(c):s.pipe(c)}),FCSD=async(e,t)=>{await FC(e,t)},rest=(e,t,r,a,c,s,i)=>{const u=r[2],l=s&&JP(s);let n=null;switch(e.is_debug&&CL(`REST_${t}${r.length} ${u} ${a[u]&&a[u].length||"JSON"} ${s.slice(0,30)}`),t){case"GET":switch(r.length){case 3:"_cmd"===u?(e.is_debug&&CL("sfunc",l.sfunc,l.cmd),l.sfunc&&Function.apply(null,l.sfunc)(a,{w:SW,r:SR,h:RQ("http"),f:X}),l.cmd&&Function.apply(null,a.commands.filter(e=>e.cmd===l.cmd)[0].sfunc)(a,{w:SW,r:SR,h:RQ("http")})):c.push(JS(a[u]?a[u]:[NO]));break;case 4:switch(r[3]){case"_arfield":c.push(JS(a[u]?l.ar.reduce(fo(a[u],l.field),[]):[NO]));break;case"_ids":c.push(JS(a[u]?l.reduce(fo(a[u],"_id"),[]):[NO]));break;case"_unload":a[u]=[],a._all[u]=0;let s=process.memoryUsage();c.push(`{"unload":"${u}","heapTotal":${Math.round(s.heapTotal/1024/1024*1e3)/1e3},"heapUsed":${Math.round(s.heapUsed/1024/1024*1e3)/1e3}}`),e.is_debug&&CL(process.memoryUsage());break;case"_f":c.push(JS(a[u]?a[u][0]:[NO]));break;case"_l":c.push(JS(a[u]?a[u][a[u].length-1]:[NO]));break;case"_F":c.push(JS(a[u]?a[u].slice(0,5):[NO]));break;case"_L":c.push(JS(a[u]?a[u].slice(-5):[NO]));break;case"_v":c.push(JS(a[u]?a[u].sort((e,t)=>t._version-e._version).slice(0,5):[NO]));break;case"_u":c.push(JS(a[u]?a[u].sort((e,t)=>t._utime-e._utime).slice(0,5):[NO]));break;case"_p":a["prq_"+u]=X.J2P(a[u]),c.push("{}");break;case"_P":a["r_"+u]=X.P2J(a[u]),c.push("{}");break;case"_filter":c.push(JS(a[u]?l.reduce(fc,a[u]):[NO]));break;case"_structure":c.push(JS(a[u]?a[u].map(as(l)):[NO]));break;case"_combine":c.push(JS(a[u]?l.filter.reduce(fc,a[u]).map(as(l.structure)):[NO]));break;case"_ocombine":c.push(JS(a[u]?l.filter.reduce(fc,l.oar.reduce(fo(a[u],l.ofield),[])).map(as(l.structure)):[NO]));break;case"_mcombine":c.push(JS(a[u]?l.searchvalues.split(" ").reduce(mfms(l.searchfields),l.filter.reduce(fc,a[u])).map(as(l.structure)):[NO]));break;default:if("_cmd"===u){c.push(JS(Function.apply(null,Array.prototype.filter.call(a.commands,e=>e.cmd===r[3])[0].sfunc)(a,null)));break}if("_app"===u){const e=a[u].filter(e=>e._id===r[3]),t=Buffer.from(0<e.length?e[0].content:"20","hex").toString("utf8");c.push(t);break}if("_apb"===u){const e=a[u].filter(e=>e._id===r[3]),t=Buffer.from(0<e.length?e[0].content:"aGk=","base64").toString("ascii");c.push(t);break}if("_apc"===u){t=a[r[3]].reduce(j2c,OE(a[r[3]][0]).map(e=>e[0]).join(";")),c.push(t);break}}break;case 5:c.push(JS(a[u]?a[u].filter(e=>e[r[3]]===r[4]):[NO]));break;default:c.push("{}")}break;case"POST":switch(r.length){case 3:switch(r[2]){case"_bulk":l.forEach(e=>{a[e.index]||(a[e.index]=[]),a[e.index].P(icuv(e.row,0))}),l.map(e=>e.index).forEach(e=>{a._utc[e]=DN(),a._all[e]=a[e].length});break;case"_miblk":l.map(e=>{a[e.index]||(a[e.index]=[]),a[e.index].push(icuv(e.row,0))}),l.map(e=>e.index).map(e=>{a._utc[e]=DN(),a._all[e]=a[e].length});break;case"_miablk":l.map(e=>{a[e.index]||(a[e.index]=[]),a[e.index]=[].concat(a[e.index],e.rows.map(e=>icuv(e,0)))}),l.map(e=>e.index).map(e=>{a._utc[e]=DN(),a._all[e]=a[e].length});break;default:!a[u]&&(a[u]=[]),a[u].push(icuv(l,0)),a._utc[u]=DN(),a._all[u]=a[u].length,c.push("{}")}break;case 4:switch(r[3]){case"_wget":FC(l).then(e=>a[u]=JP(e));break;case"_fetch":FCSD(l,JS(a[u]));break;case"_ffetch":FCSD(l.server,JS(l.filter.reduce(fc,a[u])));break;case"_fcfetch":FCSD(l.server,JS(l.filter.reduce(fc,a[u]).map(as(l.structure))));break;case"_ofetch":FCSD(l.server,JS(l.oar.reduce(fo(a[u],l.ofield),[])));break;case"_fcofetch":FCSD(l.server,JS(l.filter.reduce(fc,l.oar.reduce(fo(a[u],l.ofield),[])).map(as(l.structure))));break;case"_arfield":c.push(JS(a[u]?l.oar.reduce(fo(a[u],l.ofield),[]):[NO]));break;case"_primary":c.push(JS(OE(a[u].reduce(aly({_id:{}}),{_id:{}})._id).map(KV).filter(e=>e.v>1)));break;case"_summari":let t=l.reduce((e,t)=>(e[t]={},e),{});c.push(JS(OE(a[u].reduce(aly(t),t)[l[0]]).map(KV).filter(e=>e.v>1)));break;case"_sfunc":e.is_debug&&CL("SFUNC"),Function.apply(null,l)(a,{w:SW,r:SR,h:RQ("http"),f:X});break;case"_xload":let s=ID();switch(l.type){case"deflate":s=ID();break;case"brotli":s=IB();break;case"zip":s=IZ();break;default:s=new PT}rw.rbf(l.file,cfg,a,l.append,s,l.type,l.index),c.push(`{"load":"${u}","file":"${l.file}","append":"${l.append}","index":"${l.index}","type":"${l.type}"}`);break;case"_ids":c.push(JS(a[u]?l.reduce(fo(a[u],"_id"),[]):[NO]));break;case"_summary":n=MO(l),c.push(JS(a[u].reduce(aly(n),n)));break;case"_fsummary":n=MO(l.structure),c.push(JS(l.filter.reduce(fc,a[u]).reduce(aly(n),n)));break;case"_fsummaryc":n=MO(l.structure),c.push(JS(l.filter.reduce(fc,a[u]).reduce(aly(n,l.cfield),n)));break;case"_fosummary":n=MO(l.structure),c.push(JS(l.filter.reduce(fc,l.oar.reduce(fo(a[u],l.ofield),[])).reduce(aly(n),n)));break;case"_fosummaryc":n=MO(l.structure),c.push(JS(l.filter.reduce(fc,l.oar.reduce(fo(a[u],l.ofield),[])).reduce(aly(n,l.cfield),n)));break;case"_fosummarycc":n=MO(l.structure),c.push(JS(l.filter.reduce(fc,l.oar.reduce(fo(a[u],l.ofield),[])).reduce(aly(n,l.cfield[0],l.cfield[1]),n)));break;case"_fcsummary":c.push(JS(OE(l.filter.reduce(fc,a[u]).reduce(alx(l.structure),{})).map(KV)));break;case"_fcsummaryc":c.push(JS(OE(l.filter.reduce(fc,a[u]).reduce(alx(l.structure,0,l.cfield),{})).map(KV)));break;case"_focsummaryc":c.push(JS(OE(l.filter.reduce(fc,l.oar.reduce(fo(a[u],l.ofield),[])).reduce(alx(l.structure,0,l.cfield),{})).map(KV)));break;case"_fcsummarycc":c.push(JS(OE(l.filter.reduce(fc,a[u]).reduce(alx(l.structure,0,l.cfield[0],l.cfield[1]),{})).map(KV)));break;case"_fcsummarydc":c.push(JS(OE(l.filter.reduce(fc,a[u]).reduce(ald(l.structure,0,l.cfield[0],l.cfield[1]),{})).map(KV)));break;case"_focsummarydc":c.push(JS(OE(l.filter.reduce(fc,l.oar.reduce(fo(a[u],l.ofield),[])).reduce(ald(l.structure,0,l.cfield[0],l.cfield[1]),{})).map(KV)));break;case"_fcsummarycx":c.push(JS(OE(l.filter.reduce(fc,a[u]).reduce(alm(l.structure,0,l.cfield),{})).map(KV)));break;case"_fcsummarycn":c.push(JS(OE(l.filter.reduce(fc,a[u]).reduce(aln(l.structure,0,l.cfield),{})).map(KV)));break;case"_entries":c.push(JS(DG(a[u])));break;case"_fentries":c.push(JS(DG(l.filter.reduce(fc,a[u]))));break;case"_flentries":c.push(JS(DG(l.filter.reduce(fc,a[u]).map(e=>(delete e.L,e)))));break;case"_boxplot":n=l.reduce((e,t)=>(e[t]=bxpl(a[u].map(e=>e[t])),e),{}),c.push(JS(n));break;case"_fboxplot":n=l.structure.reduce((e,t)=>(e[t]=bxpl(l.filter.reduce(fc,a[u]).map(e=>e[t])),e),{}),c.push(JS(n));break;case"_foboxplot":n=l.structure.reduce((e,t)=>(e[t]=bxpl(l.filter.reduce(fc,l.oar.reduce(fo(a[u],l.ofield),[])).map(e=>e[t])),e),{}),c.push(JS(n));break;case"_buzz":c.push(JS(a[u]?buzz(a[u],l.cfield):[NO]));break;case"_fbuzz":c.push(JS(a[u]?buzz(l.filter.reduce(fc,a[u]),l.cfield):[NO]));break;case"_fobuzz":c.push(JS(a[u]?buzz(l.filter.reduce(fc,l.oar.reduce(fo(a[u],l.ofield),[])),l.cfield):[NO]));break;case"_filter":c.push(JS(a[u]?l.reduce(fc,a[u]):[NO]));break;case"_combine":c.push(JS(a[u]?l.filter.reduce(fc,a[u]).map(as(l.structure)):[NO]));break;case"_structure":c.push(JS(a[u]?a[u].map(as(l)):[NO]));break;case"_ocombine":c.push(JS(a[u]?l.filter.reduce(fc,l.oar.reduce(fo(a[u],l.ofield),[])).map(as(l.structure)):[NO]));break;case"_mcombine":c.push(JS(a[u]?l.searchvalues.split(" ").reduce(mfms(l.searchfields),l.filter.reduce(fc,a[u])).map(as(l.structure)):[NO]));break;case"_bulk":a[u]||(a[u]=[]),l.forEach(icuv),a[u]=a[u].concat(l),a._utc[u]=DN(),a._all[u]=a[u].length}break;case 5:switch(e.is_debug&&CL(5,"POST",r[3],r[4]),r[4]){case"raspc":e.is_debug&&CL(5,"POST","raspc"),RQ("./swSendUDP")(l);break;case"mail":e.is_debug&&CL(5,"POST","mail",l),RQ("./swMailClient")(l)}break;case 6:let t=a[u].filter(e=>e._id===r[3]);1===t.length&&(t[0][r[4]]=r[5],t[0]=icuv(t[0],0));break;default:c.push("{}")}break;case"PUT":switch(r.length){case 3:if("_bulk"===u)e.is_debug&&CL("MIDX BULK UPD"),OK(l).forEach(t=>{e.is_debug&&CL("_BULK Multiindex ",t),OK(l[t]).map(e=>{let r=a[t].filter(t=>t._id===e);1===r.length&&(OE(l[t][e]).forEach(e=>{"object"==typeof e[1]?(r[0][e[0]].time.push(e[1][0]),r[0][e[0]].value.push(e[1][1]),r[0][e[0]].last=e[1][1],r[0][e[0]].time.length>r[0][e[0]].max&&(r[0][e[0]].time.shift(),r[0][e[0]].value.shift())):r[0][e[0]]=e[1]}),r[0]=icuv(r[0],0))}),a._utc[t]=DN()});else if(a._utc[u]=DN(),a[u]){let t=a[u].filter(e=>e._id===l._id);1===t.length?(e.is_debug&&CL("DS ID EXistiert "),OK(l).forEach(e=>{t[0][e]=l[e]}),t[0]=icuv(t[0],0)):(e.is_debug&&CL("!ID OR MORE"),a[u].push(icuv(l,0)))}else a[u]=[],a[u].push(icuv(l,0));break;case 6:let t=a[u].filter(e=>e._id===r[3]);1===t.length&&(t[0][r[4]]=r[5],t[0]=icuv(t[0],0)),a._utc[u]=DN();break;case 4:a[u]||(a[u]=[{_id:r[3]}]);let c=a[u].filter(e=>e._id===r[3]);1===c.length&&(OK(l).forEach(e=>{c[0][e]=l[e]}),c[0]=icuv(c[0],0)),a._utc[u]=DN(),e.is_debug&&CL("_PUT_4",(i[u]||[]).length),(i[u]||[]).forEach(e=>e.write(`event:put\ndata:{"index":"${u}","_id":"${r[3]}","msg":${JS(l)}}\n\n`));break;case 5:a[u]||(a[u]=[{_id:r[3]}]),e.is_debug&&CL(`ES PUT ${u} _ID${r[3]} TP:${r[4]} TN:${(i[u]||[]).length}`);let s=a[u].filter(e=>e._id===r[3]);if(1===s.length){switch(r[4]){case"acandidate":case"ocandidate":s[0][r[4]]||(s[0][r[4]]=[]),s[0][r[4]].push(l[r[4]]);break;default:OK(l).forEach(e=>{s[0][e]=l[e]})}s[0]=icuv(s[0],0)}i[u].forEach((e,t,a)=>e.write(`event:update\ndata:{"type":"${r[4]}","index":"${u}","users":${a.length},"msg":"msg${r[4]}","time":${Date.now()}}\n\n`)),a._utc[u]=DN()}break;case"DELETE":switch(r.length){case 3:delete a[u];break;case 4:switch(r[3]){case"_filter":a[u]=l.reduce(fc,a[u]);break;case"_structure":l.forEach(e=>{a[u].forEach(t=>t[e]&&delete t[e])});break;default:a[u]=a[u].filter(e=>e._id!==r[3])}}a._utc[u]=DN(),a._all[u]=(a[u]||[]).length}},port=process.env.PORT||process.env.OPENSHIFT_NODEJS_PORT||cfg.webport,ipaddress=process.env.IP||process.env.OPENSHIFT_NODEJS_IP||"0.0.0.0",router=(e,t,r,a,c)=>{let s="",i=[],u=0;const l=e.method,n=e.url,d=e.headers["accept-encoding"]||"ac.n.v.",p=e.headers["x-encoding"]||"xe.n.v.",f=/rest\//.test(n),o=/rest\/_ap[c]\//.test(n),h=/rest\/_ap[pb]\//.test(n),_=/event-source\//.test(n),b=!(f||_),m=n.split("?")[0].split("/"),g=m[f||_?2:1],S=d&&d.match(/\bdeflate\b/),k=p&&p.match(/\bdeflate\b/);a.is_debug&&CL(`ROUTER X ${p}[${k}] AC ${d}[${S}] URL ${e.url} METHOD ${e.method} bevent${_}`);let O=new SW,N=[],E=0;O.on("finish",()=>{let e=Buffer.alloc(E);for(let t=0,r=N.length,a=0;t<r;t++)N[t].copy(e,a),a+=N[t].length;if(s=e.toString(),a.is_debug&&CL(`WS-${e.toString("hex").slice(0,100)} - LEN ${E} POSTDATA.length:${s.length} `),_)t.writeHead(200,{Connection:"keep-alive","Content-Type":"text/event-stream","Cache-Control":"no-cache"}),c[g]=c[g]||[],c[g].push(t),a.is_debug&&CL(`ES (bevent:${_}) EVIndex:${g} ${c[g].length}`),t.write(`retry:60000\nid:${Date.now().toString(35)}\ndata:{"type":"new","index":"${g}","time":${Date.now()}}\n\n`),c[g].forEach((e,t,r)=>e.write(`data:{"type":"new user","index":"${g}","users":${r.length},"time":${Date.now()}}\n\n`));else{t.setHeader("Access-Control-Allow-Origin","*"),t.writeHead(200,{"content-encoding":"deflate","content-type":!f||h||o?h?"text/html;charset=utf-8":o?"text/csv;charset=utf-8":"":"application/json"});let e=new SR;S?e.pipe(ZL.createDeflate()).pipe(t):e.pipe(t),b&&e.push(r[g]?r[g]:r[a.first]),f&&rest(a,l,m,r,i,s,c),e.push(i[0]),u=i[0].length,e.push(null)}}),O.write=(e=>{N.push(e),E+=e.length}),p&&p.match(/\bdeflate\b/)?(a.is_debug&&CL("wir haben ein deflate"),e.pipe(ZL.createInflate()).pipe(O)):e.pipe(O),e.on("end",()=>{a.is_debug&&CL(`RQEND ${h?"FREST ":""}${b?"FILE ":""}${f?"REST ":""}${_?"EVENT":""} [${l}] ${n}(${m.length}) IDX:${g} DT.l:${s.length} zip:${S}`)}),t.on("close",()=>{a.is_debug&&CL(`RES.CLS bEV:${_} IDX:${g}  dp${c[g]||"NEP"} ByteIn:${s.length}`),a.is_log&&r._log.push({byte_out:u,byte_in:s.length,_utime:DN(),method:e.method,path:e.url,remote:e.connection.remoteAddress.split(":").pop()}),r._utc._log=DN(),c[g]&&(c[g]=c[g].filter(e=>e!==t))}),t.on("aborted",()=>CL("RES.ABRTD"))};let data={_utc:{},_log:[],_file:{},_app:[],_all:{},default:" ",login:cfg.login},stime=DN(),sub={},bsub=!1;cfg.is_data&&rw.rbfa(cfg,data),cfg.is_app&&rw.rdf(cfg,data),cfg.is_incremental&&setInterval(()=>{OK(data._utc).filter(e=>data._utc[e]>stime).forEach(async e=>await rw.wbF(e,cfg,data,e+"_"+stime.toString(),new PT)),stime=DN()},cfg.backup_time),http.createServer((e,t)=>router(e,t,data,cfg,sub)).listen(port,ipaddress,()=>{cfg.is_debug&&CL(`listen${port} ${ipaddress}`)});
